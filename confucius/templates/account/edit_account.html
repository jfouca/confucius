{% extends 'base-in.html' %}
{% load url from future %}

{% block title %}Account{% endblock %}

{% block content_header %}
<h1>Account
        <a href="{% url 'password_change' %}" class="btn btn-info">Change my password</a>
        <a href="{% url 'close_account' %}" class="btn btn-danger">Close my account</a>
</h1>
{% endblock %}

{% block content_main %}
<form id="form" class="form-horizontal" method="post">{% csrf_token %}
    {% include 'includes/form.html' %}
    {% include 'includes/formset.html' with formset=email_formset %}
    {% include 'includes/formset.html' with formset=address_formset %}
</form>
{% endblock %}
{% block script %}
<script>
    $(function() {
        $('#form').on('submit', function() { return false; });
        $('#form').on('change', function(e) {
            $(e.target).next().html($('<i class="icon icon-refresh">'));
            $.post('{% url 'account' %}', $(this).serialize(), function(data) {
                console.log(e.target);
                console.log(data);
                $(e.target).parent().parent().parent().addClass('success');
                $(e.target).next().text('saved!');
            });
        });
    });
</script>
{% endblock %}

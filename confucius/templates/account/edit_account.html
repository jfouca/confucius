{% extends 'base-in.html' %}
{% load url from future %}

{% block title %}Account{% endblock %}

{% block content_header %}
<h1>Account
        <a href="{% url 'password_change' %}" class="btn btn-info">Change my password</a>
        {% if not user.is_superuser %}
            <a href="#" class="btn btn-danger" id="close_account">Close my account</a>
        {% endif %}
</h1>
{% endblock %}

{% block content_main %}
<form id="form" class="form-horizontal" method="post">{% csrf_token %}
    {% include 'includes/form.html' %}
    {% include 'includes/formset.html' with formset=email_formset %}
    {% include 'includes/formset.html' with formset=address_formset %}
</form>
<div class="modal hide fade" id="close_account_modal">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">Ã—</a>
        <h3>Are you sure that you want to close your account?</h3>
    </div>
    <div class="modal-body">
        <p>Once your account is closed, only the platform administrator will be able to reopen it.</p>
    </div>
    <div class="modal-footer">
        <a href="{% url 'close_account' %}" class="btn btn-large btn-danger">Yes, I am</a>
        <a data-dismiss="modal" class="btn btn-large">No</a>
    </div>
</div>
{% endblock %}
{% block script %}
<script>
    $(function() {
        $('#form').on('submit', function() { return false; });
        $('#form').on('change', function(e) {
            $(e.target).next().html($('<i class="icon icon-refresh">'));
            $.post('{% url 'account' %}', $(this).serialize(), function(data) {
                console.log(e.target);
                console.log(data);
                $(e.target).parent().parent().parent().addClass('success');
                $(e.target).next().text('saved!');
            });
        });
        $('#close_account_modal').modal({
            show: 0
        });
        $('#close_account').on('click', function() {
            $('#close_account_modal').modal('show');
        });
    });
</script>
{% endblock %}

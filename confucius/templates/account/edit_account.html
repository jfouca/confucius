{% extends "base-in.html" %}
{% load url from future %}

{% block title %}User profile{% endblock %}

{% block content_header %}
<h1>User profile</h1>
{% endblock %}

{% block content_main %}
<div class="well">
Here you can edit your profile.
</div>

{% if form.errors %}
<div class="alert alert-error">
    {{ form.errors }}
</div>
{% endif %}

<form class="form-horizontal" method="post" action="{% url 'account' %}">
{% csrf_token %}
    <fieldset>
        <div class="control-group">
            <label class="control-label" for="firstName">Me</label>
            <div class="controls">
                <div class="controls-inputs">
                    <input type="text" id="firstName" class="input-medium" placeholder="First name" value="{{ account.first_name }}" name="{{ form.first_name.html_name }}"> <input type="text" id="lastName" class="input-medium" placeholder="Last name" value="{{ account.last_name }}">
                </div>
            </div>
        </div>
       <div class="control-group">
            <label class="control-label">Language(s)</label>
            <div class="controls">
                {% for lang in account.languages.all %}
                    <input type="text" class="input-small" placeholder="Code" value="{{ lang.code }}"> <textarea type="text" class="input-medium" placeholder="Lang" value="{{ lang.name }}"></textarea>
                {% endfor %}
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">E-mail @ddress(es)</label>
                <div class="controls" id="emails">
                    {% for email in account.emailaddress_set.all %}
                        {% if email.main %}
                             <div class="controls-inputs" id="email-main">
                                <input type="text" class="input-medium"placeholder="Description" value="{{ email.name }}"> <input type="text" class="input-large" placeholder="E-mail" value="{{ email.value }}"> <span class="help-inline"><a href="#" id="rm-email-main"><i class="icon-remove"></i></a> <a href="#" id="add-email"><i class="icon-plus"></i></a></span>
                             </div>
                        {% else %}
                            <div class="controls-inputs" id="email-{{ email.value }}">
                                <input type="text" class="input-medium" placeholder="Description" value="{{ email.name }}"> <input type="text" class="input-large" placeholder="E-mail" value="{{ email.value }}"> <span class="help-inline"><a href="#" id="rm-email-{{ email.value }}"><i class="icon-remove"></i></a></span>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">Physical address(es)</label>
            <div class="controls">
                {% for postal in account.postaladdress_set.all %}
                    <input type="text" class="input-medium" placeholder="Description" value="{{ postal.name }}"> <textarea type="text" class="input-large" placeholder="Address" value="{{ postal.value }}"></textarea>
                {% endfor %}
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Update</button>
            <button type="reset" class="btn">Cancel</button>
        </div>
    </fieldset>
</form>
{% endblock %}

{% block script %}
<script>
$(document).ready(function() {
    $('#add-email').live('click', function() {
        var r = Math.floor(Math.random()*10000);
        $('#emails').append('<div class="controls-inputs" id="email-'+r+'"><input type="text" class="input-medium" placeholder="Description"> <input type="text" class="input-large" placeholder="E-mail"> <span class="help-inline"><a href="#" id="rm-email-'+r+'"><i class="icon-remove"></i></a></span></div>');
        $('#email-'+r).hide()
        $('#email-'+r).fadeIn('normal');
    });
    $("a[id^='rm-email-']").live('click', function() {
        var email = "#"+$(this).attr('id').substring(3);
        
        if (email == '#email-main') {
            $(email).remove();
            $('#emails').prepend('<div class="controls-inputs" id="email-main" ><input type="text" class="input-medium"placeholder="Description" value="{{ email.name }}"> <input type="text" class="input-large" placeholder="E-mail"> <span class="help-inline"><a href="#" id="rm-email-main"><i class="icon-remove"></i></a> <a href="#" id="add-email"><i class="icon-plus"></i></a></span></div>');
        }
        
        else {
            $(email).fadeOut('normal', function() {
                $(email).remove();
            });
        }
    });
});
</script>
{% endblock %}

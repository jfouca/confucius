{% extends 'base-in.html' %}
{% load url from future %}

{% block title %}Conference "{{ conference.title }}"{% endblock %}

{% block brand %}Conference "{{ conference.title }}"  {% if not conference.is_open %}(closed){% endif %}{% endblock %}

{% block content_header %}
<h1>Dashboard {% include 'includes/roles.html' with roles=membership.roles.all %}</h1>
<p>
    <span class="label label-info">Public conference link :</span> <a href="{{ public_url }}">{{ public_url }}</a>
</p>
{% endblock %}

{% block content_main %}
<!-- Chair part -->
{% if membership.has_chair_role %}
<div class="row">
    <div class="span10">
        <div class="row toggle-top">
            <div class="span10">
                <div class="row toggle-div">
                    <div class="span10">
                        <h2>Chair Part
                        <i class="pull-right icon icon-chevron-down"></i></h2>
                    </div>
                </div>
                <div class="row">
                    <div class="span10 toggle-buttons">
                        <div class="pull-left">
                            <a href="{% url 'sendEmailtoUsers' conference.pk %}" class="btn btn-info" >Send Emails to users</a>
                        </div>
                        <div class="pull-right">
                            <a href="{% url 'sendEmailtoUsers' conference.pk %}" class="btn btn-primary" >Edit conference</a>
                            <a href="{% url 'assignments' conference.pk %}" class="btn btn-primary">Assignments</a>
                            <a href="{% url 'paper_selection_list' conference.pk %}" class="btn btn-primary">Paper selection</a>
                            <a href="{% url 'alert' conference.pk %}" class="btn btn-primary">Create Alert</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="toggle hidden"><!-- toggle -->
        <div class="row">
            <div class="span10 toggled">
                <div class="row">
                    <div class="span5">
                        <h3>Last submissions</h3>
                        <table class="table table-striped table-bordered">
                        <tbody>
                            <tr>
                                <th>Title</th>
                                <th>Submit date</th>
				<th>Submitter</th>
                            </tr>
                        {% for paper in conference_papers %}
                            <tr>
                                <td><b><a href="{% url 'paper' conference.pk paper.pk %}"> {{paper.title}}</b></td>
                                <td>{{paper.submission_date|date:"m/d/y"}}</td>
                                <td>{{paper.submitter}}</td>

                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="2">No submissions for this conference.</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        </table>
                    </div>
                    <div class="span5">
                        <h3>Last finished reviews</h3>
                        <table class="table table-striped table-bordered">
                        <tbody>
                            <tr>
                                <th>Paper title</th>
                                <th>Review title</th>
                            </tr>
                        {% for assignment in conference_reviews %}
                            <tr>
                                <td><a href="{% url 'submit_review' conference.pk assignment.pk %}"> {{assignment.paper.title}}</td>
                                <td>{{assignment.review.title}}</td>
                            </tr>
                        {% empty %}
                            <tr><td colspan="2">No reviews for this conference.</td></tr>
                        {% endfor %}
                        </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="span10">
                        <h3>Next alerts</h3>
                        <table class="table table-striped table-bordered">
                        <tbody>
                        <tr>
                            <th>Title</th>
                            <th>Trigger</th>
                            <th>Recipients</th>
                            <th></th>
                            <th></th>
                        </tr>
                        {% if not alerts_trigget and not alerts_reminder and not alerts_action %}
                            <tr><td colspan=5>No alert has been programmed for this conference.</td></tr>
                        {% endif %}

                        {% for alert in alerts_trigger %}
                            <tr>
                                <td><b>{{alert.title}}</b></td>
                                <td>{{alert.trigger_date|date:"m/d/y"}}</td>
                                <td>{{ alert.roles.all|join:', '}}</td>
                                <td><center><a href="{% url 'alert' conference.pk alert.pk %}" class="btn">Edit the alert</a></center></td>
                                <td><center><a href="{% url 'delete_alert' conference.pk alert.pk %}" class="btn btn-danger">Delete the alert</a></center></td>
                            </tr>
                        {% endfor %}

                        {% for alert in alerts_reminder %}
                            <tr>
                                <td><b>{{alert.title}}</b></td>
                                <td>{{alert.reminder.name}} + {{alert.event.name}}</td>
                                <td>{{ alert.roles.all|join:', '}}</td>
                                <td><center><a href="{% url 'alert' conference.pk alert.pk %}" class="btn">Edit the alert</a></center></td>
                                <td><center><a href="{% url 'delete_alert' conference.pk alert.pk %}" class="btn btn-danger">Delete the alert</a></center></td>
                            </tr>
                        {% endfor %}
                        

                        {% for alert in alerts_action %}
                            <tr>
                                <td><b>{{alert.title}}</b></td>
                                <td>{{alert.action.name}}</td>
                                <td>{{ alert.roles.all|join:', '}}</td>
                                <td><center><a href="{% url 'alert' conference.pk alert.pk %}" class="btn">Edit the alert</a></center></td>
                                <td><center><a href="{% url 'delete_alert' conference.pk alert.pk %}" class="btn btn-danger">Delete the alert</a></center></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div><!-- /toggle -->
        </div>
    </div>
</div>

{% endif %}


<!-- Submitter part -->
{% if membership.has_submitter_role %}
<div class="row">
    <div class="span10">
        <div class="row toggle-top">
            <div class="span10">
                <div class="row toggle-div">
                    <div class="span10">
                        <h2>Submitter Part
                        <i class="pull-right icon icon-chevron-down"></i></h2>
                    </div>
                </div>
                <div class="row">
                    <div class="span10 toggle-buttons">
                        <div class="pull-right">
                            <a href="{% url 'paper' membership.conference.pk %}" class="btn btn-primary">Submit paper</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="toggle hidden"><!-- toggle -->
        <div class="row">
            <div class="span10 toggled">
                <h3>My submissions</h3>
                <table class="table table-striped table-bordered">
                <tbody>
                    <tr>
                        <th>Title</th>
                        <th>Submit date</th>
                        <th>Last update date</th>
                        <th></th>
                    </tr>
                    {% for paper in user_papers.all %}
                    <tr>
                        <td><b>{{paper.title}}</b></td>
                        <td>{{paper.submission_date|date:"m/d/y"}}</td>
                        <td>{{paper.last_update_date|date:"m/d/y"}}</td>
                        <td><center><a href="{% url 'paper' conference.pk paper.pk %}" class="btn btn">Edit paper</a></center></td>
                    </tr>
                    {% empty %}
                        <tr><td colspan="4">You haven't submit a paper for this conference.</td></tr>
                    {% endfor %}
                </tbody>
                </table>
            </div>
        </div><!-- /toggle -->
        </div>
    </div>
</div>
    
{% endif %}

<!-- Reviewer part -->
{% if membership.has_reviewer_role %}
<div class="row">
    <div class="span10">
        <div class="row toggle-top">
            <div class="span10">
                <div class="row toggle-div">
                    <div class="span10">
                        <h2>Reviewer Part
                        <i class="pull-right icon icon-chevron-down"></i></h2>
                    </div>
                </div>
            </div>
        </div>
        <div class="toggle hidden"><!-- toggle -->
        <div class="row">
            <div class="span10 toggled">
                <h3>My assignments</h3>
                <table class="table table-striped table-bordered">
                <tbody>
                    <tr>
                        <th>Paper title</th>
                        <th>Is done ?</th>
                        <th></th>
                    </tr>
                    {% for assignment in user_assignments.all %}
                    <tr>
                        <td><b>{{assignment.paper.title}}</b></td>
                        <td>{{assignment.is_done}}</td>
                        <td><center><a href="{% url 'submit_review' conference.pk assignment.pk %}" class="btn
                            {% if assignment.is_done %} 
                                ">Edit review 
                            {% else %} 
                                btn-info"><b>Submit review</b> 
                            {% endif %}
                        </a></center></td>
                    
                    </tr>
                    {% empty %}
                        <tr><td colspan="4">You haven't receive an assignment for this conference.</td></tr>
                    {% endfor %}
                </tbody>
                </table>
            </div>
        </div><!-- /toggle -->
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block style %}
<style>
    .hidden {
        display: none;
    }
    .visible {
        display: block;
    }
    .toggle-top h2 {
        margin-bottom: 15px;
        padding: 10px 15px 5px 5px;
        border-top: 3px solid lightgrey;
        background-color: #f8f8f8;
    }
    .toggle-top h3 {
        padding-left: 5px;
    }
    .toggle-top h2:hover {
        cursor: pointer;
    }
    .toggle-buttons {
        margin-bottom: 15px;
        text-align: center;
    }
    .toggled {
        padding-top: 15px;
        border-top: 1px solid lightgrey;
    }
</style>
{% endblock %}

{% block script %}
<script>
    $(function() {
        {% if membership.roles.count < 2 %}
            $('.toggle-div').next().toggleClass('hidden');
            $('.toggle-div').next().toggleClass('visible');
        {% endif %}
        $('.toggle-div').click(function() {
            $(this).parents('.toggle-top').next('.toggle').slideToggle('slow');
            $(this).parents('.toggle-top').next('.toggle').toggleClass('hidden');
            $(this).parents('.toggle-top').next('.toggle').toggleClass('visible');
            
            $(this).find('.icon').toggleClass('icon-chevron-up')
            $(this).find('.icon').toggleClass('icon-chevron-down');
            return false;
        });
    }); 
</script>
{% endblock %}
